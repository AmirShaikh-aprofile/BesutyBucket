<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BeautyBucket</title>
<style>
  body{font-family:Arial;background:#fdf6f9;margin:0}
  header{background:#ff4da6;padding:18px;text-align:center;color:#fff}
  .container{display:flex;padding:12px;gap:12px}
  .sidebar{width:220px}
  .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;flex:1}
  .product-card{background:#fff;padding:12px;border-radius:8px;text-align:center;box-shadow:0 1px 6px rgba(0,0,0,.06)}
  .product-card img{width:130px;height:130px;object-fit:contain}
  .price{font-weight:bold;margin:4px 0}
  .discount{background:#d0f0c0;color:#2b7a0b;font-size:12px;padding:2px 4px;border-radius:4px;margin-left:4px}
  button.whatsapp{background:#25D366;color:#fff;padding:6px 12px;border:none;border-radius:6px;margin-top:6px;cursor:pointer}
</style>
</head>
<body>
<header>
  <h1>BeautyBucket</h1>
  <small>Quality Cosmetics. Quick Delivery.</small>
</header>

<div class="container">
  <div class="sidebar">
    <ul id="categoryList" style="padding:0;list-style:none"></ul>
  </div>

  <div style="flex:1">
    <input id="searchInput" placeholder="Search products..." style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc" />
    <div class="products" id="productList"></div>
  </div>
</div>

<script>
const API='/api';
let allProducts=[];

async function loadProducts(){
  try{
    const res=await fetch(`${API}/products`);
    allProducts=await res.json();
    renderProducts(allProducts);
  }catch(e){ console.error(e); }
}

function renderProducts(list){
  const el=document.getElementById('productList');
  el.innerHTML='';
  list.forEach(p=>{
    const div=document.createElement('div');
    div.className='product-card';
    div.innerHTML=`
      <img src="/images/${p.image_url||'Pic.jpg'}" alt="${p.name}" />
      <h4>${p.name}</h4>
      <p>${p.details}</p>
      <p>${p.category}</p>
      <p>
        <strike>₹${p.mrp}</strike><br>
        <span class="price">₹${p.selling_price_1pc}<span class="discount">${p.discount_1pc_percent}% off</span></span><br>
        <span class="price">₹${p.selling_price_5pc}<span class="discount">${p.discount_5pc_percent}% off</span></span>
      </p>
      <button class="whatsapp" onclick="buyWhatsapp('${p.name}')">Buy via WhatsApp</button>
    `;
    el.appendChild(div);
  });
}

function buyWhatsapp(productName){
  const msg=encodeURIComponent(`Hi, I want to buy ${productName} from BeautyBucket.`);
  window.open(`https://wa.me/?text=${msg}`,'_blank');
}

// Load categories
async function loadCategories(){
  try{
    const res=await fetch(`${API}/categories`);
    const cats=await res.json();
    const list=document.getElementById('categoryList');
    list.innerHTML='<li style="background:#ff4da6;color:#fff;padding:8px;margin-bottom:8px;border-radius:6px;cursor:pointer" onclick="renderProducts(allProducts)">All Products</li>';
    cats.forEach(c=>{
      const li=document.createElement('li');
      li.style="background:#ff4da6;color:#fff;padding:8px;margin-bottom:8px;border-radius:6px;cursor:pointer";
      li.textContent=c.name;
      li.onclick=async ()=>{
        const r=await fetch(`${API}/category/${encodeURIComponent(c.name)}`);
        const products=await r.json();
        renderProducts(products);
      };
      list.appendChild(li);
    });
  }catch(e){ console.error(e); }
}

document.getElementById('searchInput').addEventListener('input',()=>{
  const q=document.getElementById('searchInput').value.trim().toLowerCase();
  const filtered=allProducts.filter(p=>(p.name||'').toLowerCase().includes(q));
  renderProducts(filtered);
});

loadCategories();
loa

